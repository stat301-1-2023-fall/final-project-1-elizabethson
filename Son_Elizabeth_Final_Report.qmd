---
title: "Happiness: A Sacrifice for Productivity?"
subtitle: |
  | Final Project 
  | Data Science 1 with R (STAT 301-1)
author: "Elizabeth Son"
date: today

format:
  html:
    toc: true
    embed-resources: true
    
execute:
  echo: false
  warning: false

from: markdown+emoji 
---
```{r}
#| echo: false
#| label: load-pkgs-data

#libraries
library(tidyverse)
library(dplyr)

#data
gdp_happiness <- read_rds("data/gdp_happiness.rds")
```

::: {.callout-tip icon=false}

## Github Repo Link

[https://github.com/stat301-1-2023-fall/final-project-1-elizabethson](https://github.com/stat301-1-2023-fall/final-project-1-elizabethson)

:::

## Introduction
As an economics major, the focus of many of my classes have been quantitative, such as GDP and unemployment. What hasn't been addressed enough, however, is whether maximized productivity in the form of economic growth or power can also impact citizens' well-being. The ideal nation shouldn't just be wealthy and powerful, but also have happy citizens who can then contribute to society in more positive ways.

The research question that initially motivated this project was: Is there a correlation between happiness and productivity?

This report grew from this question, expanding to... TYPE HERE

The data sources that were used to carry out this exploration comes from ["GDP Over Hours Worked"](https://github.com/TheEconomist/the-economist-gdp-per-hour-estimates/blob/main/output-data/gdp_over_hours_worked.csv), the dataset behind an article titled ["All work and no play"]([https://www.economist.com/graphic-detail/2023/10/04/productivity-has-grown-faster-in-western-europe-than-in-america) from The Economist. The datasets on happiness measures come from [“The World Happiness Report”](https://www.kaggle.com/datasets/unsdsn/world-happiness) for the years from 2015 to 2019. 

A key distinction is the definition of productivity. The definition mostly used throughout this report draws on the one provided by the Bureau of Labor Statistics: productivity is a measure of economic performance that compares the amount of goods and services produced (output) with the amount of inputs used to produce those goods and services. For this project, the input is labor force size and the output is GDP, scaled by purchasing power parity (PPP): GDP PPP / Labor Force (`gdp_ppp_over_labor_force`).

My data exploration not only includes analyses by country, but also over time. Since the Happiness Report datasets only contain 5 years of data, the data over time combining all of the datasets will be restricted to the years 2015 to 2019. 

## Data Overview
The data used in this exploration comes from 6 different datasets:

### One GDP Over Hours Worked Dataset
#### Description:
The "GDP Over Hours Worked" dataset contains variables and variable transformations according to the original author's intent to measure productivity based on metrics such as PPP (Purchasing Power Parity) and hours worked. Each observation corresponds to a different year (from 1980 to 2022) and country.

#### Features: 
"GDP Over Hours Worked" is a 2.7 MB dataset with 11560 observations and 27 variables: 3 categorical and 24 numerical. Some of the numerical variables have missing values. 

### Five Happiness Report Datasets
#### Description: 
Each "Happiness Report" dataset details happiness level by country calculated from Gallup World Poll data, which utilized surveys based on the Cantril ladder. The Cantril ladder asks respondents to rate their "own current lives" on a scale of 0 to 10 to determine an average "Happiness Score" by country. In addition to Happiness Score, there are six other relevant variables such as "healthy life expectancy".

#### Features: 
"Happiness Report" datasets contain information on the years 2015, 2016, 2017, 2018, and 2019. Each dataset contains 158, 157, 155, 156, and 156 observations as well as 12, 13, 12, 9, and 9 variables respectively. The datasets from 2015 and 2016 have two categorical variables, while the datasets from 2017, 2018, and 2019 have one categorical variable. The remaining variables are numerical. There are no missing values in any of the "Happiness Report" datasets. 

## Explorations
A correlation plot on GDP variables such as "GDP over population" (`gdp_over_pop_c`) and "employment rate" (`employment_rate`) as well as "Happiness Score" (`happiness_score`) provides insight into which relationships have high correlations with happiness.

From @fig-1, a strong, positive correlation is seen between productivity, measured by "GDP PPP / Labor Force" (`gdp_ppp_over_labor_force`), and happiness. This means that as happiness increases in a country, productivity also increases.

@fig-1 also shows a negative correlation between "unemployment rate" (`unemployment_r`) and happiness. This means that as happiness increases in a country, the unemployment rate decreases. 

```{r}
#| echo: false
#| label: fig-1
#| fig.cap: Correlation plot of GDP variables and happiness score

corr <- gdp_happiness |> 
  select(pop:employment_rate, employed, gdp_over_pop:gdp_over_pop_c, happiness_score) |> 
  cor(use = "complete.obs")
ggcorrplot::ggcorrplot(corr) +
  ggtitle("Correlation Plot: GDP Variables and Happiness Score")
```

These two relationships are explored further in the following sections. 

### Happiness v. Productivity
As expected from the correlation plot in @fig-1, there is a positive relationship between productivity and happiness. Nevertheless, the connection appears to exhibit a concave rather than a linear trend, indicating that as productivity rises, happiness increases, but not in direct proportion. For example, the same positive change in productivity yields a larger positive change in happiness for countries with lower productivity than those with high productivity. @fig-2 visualizes this concave relationship. 

```{r}
#| echo: false
#| label: fig-2
#| fig.cap: Scatter plot of productivity v. happiness

gdp_happiness |> 
  ggplot(aes(x = gdp_ppp_over_labor_force, y = happiness_score)) +
  geom_jitter() +
  theme_minimal() +
  geom_smooth(method = lm, se = FALSE) +
  labs(title="Happiness Score v. Productivity", 
       x = "GDP PPP / Labor Force", y= "Happiness Score")
```

Rather than simply determining the relationship between happiness and productivity as logarithmic, further differentiating the relationship by region provides further insight into regional differences and how they impact this relationship. 

To see how regions can vary greatly in aspects such as happiness and productivity, @fig-3 and @fig-4 visualize how much average happiness and average productivity differs by region.

In @fig-3, average happiness score shows the mean happiness scores of each country within a region. Countries in Australia and New Zealand, North America, and Western Europe have the highest average happiness scores while countries in Sub-Saharan Africa have the lowest.

```{r}
#| echo: false
#| label: fig-3
#| fig.cap: Mean happiness by region

mean_happiness_by_region <- gdp_happiness |> 
  group_by(region) |> 
  summarise(mean_happiness = mean(happiness_score, na.rm = TRUE))

mean_happiness_by_region |> 
  ggplot(aes(x = region, y = mean_happiness, fill = region)) +
  geom_col() +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title="Happiness by Region", 
       x="Region", y= "Average Happiness Score")
```

In @fig-4, average productivity shows the mean GDP PPP / Labor Force of each country within a region. The differences by region are much more pronounced for productivity compared to happiness: the regions with countries having the highest average productivity, North America and Western Europe, have a mean GDP PPP / Labor Force over 8 times greater than countries in Sub-Saharan Africa.

```{r}
#| echo: false
#| label: fig-4
#| fig.cap: Mean productivity by region

mean_productivity_by_region <- gdp_happiness |> 
  group_by(region) |> 
  summarise(mean_gdp_ppp_over_labor_force = mean(gdp_ppp_over_labor_force, na.rm = TRUE))

mean_productivity_by_region |> 
  ggplot(aes(x = region, y = mean_gdp_ppp_over_labor_force, fill = region)) +
  geom_col() +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title="Productivity by Region", 
       x="Region", y= "Average GDP PPP / Labor Force")
```

Based on the above plots, faceting by region is a reasonable approach and valid differentiation for visualizing the relationship between happiness and productivity. @fig-5 shows scatterplots faceted by region of the relationship between productivity and happiness. 

```{r}
#| echo: false
#| label: fig-5
#| fig.cap: Scatter plot of happiness v. productivity, faceted by region

gdp_happiness |> 
  ggplot(aes(x = gdp_ppp_over_labor_force, y = happiness_score, color = region)) +
  geom_jitter() +
  theme_minimal() +
  facet_wrap(vars(region)) +
  geom_smooth(method = lm, se = FALSE, color = "gray") +
  labs(title="Happiness Score v. Productivity", 
       x="GDP PPP / Labor Force", y= "Happiness Score",
       subtitle = "by Region")
```

Surprisingly, the positive relationship between happiness and productivity does not hold up across regions. @fig-5 reveals that there is a positive relationship between happiness and productivity in regions such as Southeastern Asia and Latin America and Caribbean. However, in North America, the relationship between happiness and productivity is negative. Further, the relationship is weak for Australia and New Zealand.

Further, some regions exhibit more concave relationships between happiness and productivity than others, such as Southeastern Asia and Western Europe.

### Happiness v. Unemployment Rate 
@fig-1 also showed a strong correlation between happiness and unemployment rate, one which was negative. 

@fig-6 visualizes the negative relationship between unemployment rate and happiness. This relationship is not as strong as the one between productivity and happiness, but still exhibits that as unemployment rate increases, happiness tends to decrease.

```{r}
#| echo: false
#| label: fig-6
#| fig.cap: Scatter plot of unemployment rate v. happiness

gdp_happiness |> 
  ggplot(aes(x = unemployment_r, y = happiness_score)) +
  geom_jitter() +
  theme_minimal() +
  geom_smooth(method = lm, se = FALSE) +
  labs(title="Happiness Score v. Unemployment Rate", 
       x = "Unemployment Rate", y= "Happiness Score")
```

Again, regional differences in mean unemployment rate may be driving a relationship that is stronger for some regions than others. @fig-7 shows that the average unemployment rates for countries in regions such as Southeastern Asia and Eastern Asia are much lower than the average unemployment rates in the Middle East and Northern Africa. 

```{r}
#| echo: false
#| label: fig-7
#| fig.cap: Mean unemployment rate by region

mean_unemployment_r_by_region <- gdp_happiness |> 
  group_by(region) |> 
  summarise(mean_unemployment_r = mean(unemployment_r, na.rm = TRUE))

mean_unemployment_r_by_region |> 
  ggplot(aes(x = region, y = mean_unemployment_r, fill = region)) +
  geom_col() +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title="Unemployment Rate by Region", 
       x="Region", y= "Average Unemployment Rate")
```

Thus, @fig-8 facets the relationship between happiness and unemployment rate by region. 

```{r}
#| echo: false
#| label: fig-8
#| fig.cap: Scatter plot of happiness v. unemployment rate, faceted by region

gdp_happiness |> 
  ggplot(aes(x = unemployment_r, y = happiness_score, color = region)) +
  geom_jitter() +
  theme_minimal() +
  facet_wrap(vars(region)) +
  geom_smooth(method = lm, se = FALSE, color = "gray") +
  labs(title="Happiness Score v. Unemployment Rate", 
       x="Unemployment Rate", y= "Happiness Score",
       subtitle = "by Region")
```

Surprisingly, the negative correlation between happiness and unemployment rate across all regions did not hold up after faceting by region. For example, for countries in the region Sub-Saharan Africa, the relationship between happiness and unemployment rate was actually positive: as unemployment increases, happiness also increases. In contrast, countries in regions such as Southern Asia and the Middle East and Northern Africa show a strong, negative relationship between happiness and unemployment rate. For countries in regions such as Latin America and Caribbean, the relationship between happiness and unemployment rate is very weak. 

The scatterplots faceted by region provide greater insight into 

### Multivariate Analysis: Happiness, Productivity, and Unemployment Rate 

### Time Trends

## Conclusion

## References
The Economist (2023). All work and no play, [https://www.economist.com/graphic-detail/2023/10/04/productivity-has-grown-faster-in-western-europe-than-in-america](https://www.economist.com/graphic-detail/2023/10/04/productivity-has-grown-faster-in-western-europe-than-in-america)

The Economist (2023). GDP Over Hours Worked, [https://github.com/TheEconomist/the-economist-gdp-per-hour-estimates/blob/main/output-data/gdp_over_hours_worked.csv](https://github.com/TheEconomist/the-economist-gdp-per-hour-estimates/blob/main/output-data/gdp_over_hours_worked.csv)

Kaggle (2019). World Happiness Report, [https://www.kaggle.com/datasets/unsdsn/world-happiness](https://www.kaggle.com/datasets/unsdsn/world-happiness)

U.S. Bureau of Labor Statistics. Productivity 101, [https://www.bls.gov/k12/productivity-101/content/what-is-productivity/home.htm](https://www.bls.gov/k12/productivity-101/content/what-is-productivity/home.htm)

## Appendix: Technical Information

### Data Cleaning: Combining Datasets
Before the explorations on the datasets began, the six different datasets had to be merged into one. To do this, a variable called `year` was added to each "Happiness Report" dataset. Then, `country` and `year` were used as primary keys to merge the datasets into one, called `gdp_happiness`.

### Data Cleaning: Country Names
Some countries changed names over time, leading to different names in the `country` variable for the same country in between the six datasets. Thus, some `country` names were manually updated to their more modern name. In addition, `Namibia` was excluded from the final, combined dataset because the "GDP Over Hours Worked" dataset had multiple different observations of each `country` and `year` variable for Namibia. 

### Missing Data: Measuring Productivity
Aside from the formal definition of productivity, the decision to measure productivity by GDP PPP divided by labor force instead of GDP PPP divided by hours worked was driven by missingness in the "GDP Over Hours Worked" dataset.

First, I wanted to see which variables had a high number of missing observations, `NA`. 

```{r}
#| echo: false
#| label: fig-a
#| fig.cap: Type here

gdp_happiness |> 
  summarise(across(everything(), ~ sum(is.na(.)))) |> 
  pivot_longer(everything(), names_to = "variable", values_to = "na_count") |> 
  slice_max(na_count, n = 15) |> 
  knitr::kable()
```

Many of the variables with a high count of NA observations involved hours worked. So, I examined these variables further. 

```{r}
#| echo: false
#| label: fig-b
#| fig.cap: Type here

gdp_happiness |> 
  mutate(missing_hours_worked = is.na(hours_worked),
         missing_total_hours = is.na(total_hours),
         missing_hours_per_employed = is.na(hours_per_employed),
         missing_gdp_ppp_over_k_hours_worked = is.na(gdp_ppp_over_k_hours_worked),
         missing_gdp_ppp_over_k_hours_worked_c = is.na(gdp_ppp_over_k_hours_worked_c)) |> 
  count(missing_hours_worked, missing_total_hours, missing_hours_per_employed, missing_gdp_ppp_over_k_hours_worked, missing_gdp_ppp_over_k_hours_worked_c) |> 
  knitr::kable()
```

I expected a return of every iteration of TRUE/FALSE. However, the majority of combinations were TRUE for variables regarding hours. Thus, missingness many observations was largely in part due to an hour variable used to calculate other, relevant variables being missing. 